<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Final Project</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babylonjs/4.0.3/babylon.max.js"></script>
    <script src="https://preview.babylonjs.com/gui/babylon.gui.js"></script> <!-- GUI for babylonjs -->
	<script src="https://github.com/BabylonJS/Babylon.js/blob/master/dist/preview%20release/proceduralTexturesLibrary/babylon.grassProceduralTexture.js"></script>
	<script src="https://github.com/BabylonJS/Babylon.js/blob/master/dist/preview%20release/proceduralTexturesLibrary/babylon.grassProceduralTexture.min.js"></script>
	<script src="https://cdn.babylonjs.com/proceduralTexturesLibrary/babylonjs.proceduralTextures.min.js"></script>
	<script src="https://github.com/BabylonJS/Babylon.js/blob/master/dist/preview%20release/materialsLibrary/babylon.skyMaterial.js"></script>
	<script src="https://github.com/BabylonJS/Babylon.js/blob/master/dist/materialsLibrary/babylon.skyMaterial.d.ts"> </script>
	<script src="https://github.com/BabylonJS/Babylon.js/blob/master/dist/materialsLibrary/babylon.skyMaterial.min.js"></script>
	<script src="https://preview.babylonjs.com/materialsLibrary/babylonjs.materials.js"></script>

	<style>
        #canvas {
            width:100%;
            height:100%;
        }
    </style>
</head>

<body>
    <canvas id="canvas"></canvas>
    <script>
        window.addEventListener('DOMContentLoaded', function()
            {
                var canvas = document.getElementById('canvas');

                var engine = new BABYLON.Engine(canvas, true);

                var createScene = function(){
                    var houseModel1;
                    
                    //scene
                    var scene = new BABYLON.Scene(engine);
                    scene.collisionEnabled = true;
                    scene.checkCollisions = true;
					scene.gravity = new BABYLON.Vector3(0, -9.81, 0);

                    //ground
                    var myGround = BABYLON.MeshBuilder.CreateGround("myGround", {width: 1500, height: 2000, subdivisions: 4}, scene);
					myGround.checkCollisions = true;

                    //grass texture for ground
                    var grassMaterial = new BABYLON.StandardMaterial("grass", scene);
					var grassTexture = new BABYLON.GrassProceduralTexture("grassTexture", 256, scene);
					grassMaterial.ambientTexture = grassTexture;
                    myGround.material = grassMaterial;

                    //sky
					var skyMaterial = new BABYLON.SkyMaterial("skyMaterial", scene);
					skyMaterial.backFaceCulling = false;
					skyMaterial.luminance = 1;
					var skyBox = BABYLON.Mesh.CreateBox("skyBox", 4000.0, scene);
					skyBox.material = skyMaterial;

                    //light source
                    var light = new BABYLON.HemisphericLight("HemiLight",new BABYLON.Vector3(0,100,0),scene);
                    
                    //house model
                    BABYLON.SceneLoader.ImportMesh("","","house.babylon", scene, function(meshes){
                        meshes.forEach(function(mesh){
                            mesh.position = new BABYLON.Vector3(0,-1,0);
                            mesh.checkCollisions = true;
                            houseModel1 = mesh;
                        });
                    });
                    
                    //camera 1st person
					// var camera = new BABYLON.FlyCamera("Camera",new BABYLON.Vector3(0,70,-500), scene); //AWSD
					// camera.attachControl(canvas, true);
					// camera.applyGravity = true;
					// camera.checkCollisions = true;
					// camera.maxCameraSpeed = 1;
					// camera.speed = 10;
					// camera.rollCorrect = 10;
					// camera.ellipsoid = new BABYLON.Vector3(10 , 35, 10);

                    //camera 3rd person
                    var camera = new BABYLON.ArcRotateCamera("arcCam",BABYLON.Tools.ToRadians(60),BABYLON.Tools.ToRadians(60),2000,BABYLON.Vector3.Zero(),scene);
                    camera.attachControl(canvas,true);

                    //GUI
                    var menu = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI("Menu");

                    var fountain_button = BABYLON.GUI.Button.CreateSimpleButton("fountain_button", "Fountain");
                    fountain_button.width = "100px";
                    fountain_button.height = "50px";
                    fountain_button.cornerRadius = 20;
                    fountain_button.color = "white";
                    fountain_button.background = "blue";
                    fountain_button.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;
                    fountain_button.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;
                    fountain_button.left = "30px";
                    fountain_button.top = "-120px";
                    fountain_button.onPointerUpObservable.add(function(){
                        alert("it works!!!");
                    });

                    menu.addControl(fountain_button);

                    //pointer lock
					canvas.requestPointerLock();
					document.exitPointerLock = document.exitPointerLock;
					canvas.onclick = function(){
					    canvas.requestPointerLock();
					}
                    
                    return scene;
                }

                var scene = createScene();
                engine.runRenderLoop(function()
                    {
                        scene.render();
                    }
                );
            }
        );
    </script>
</body>
</html>
